/*! jquery.navigationBar.js © yamoo9.net, 2015 */

define(["plugins/radioClass/jquery.radioClass","utils/jquery.utils"],function(){"use strict";var e="navigationBar",t=0,i=function(t,i){this.$el=t,this.el=t[0],this.config=$.extend(!0,{},$.fn[e].defaults,i),this.menuitemIndex=0,this.menuitemCurrent=0,this.init()};i.prototype={init:function(){this.build=++t,this.settings(),this.events()},settings:function(){this.referenceLevelElements(),this.setClass(),this.config.aria&&this.setARIA()},referenceLevelElements:function(){var e=this;$.each([1,2,3],function(t,i){e["$lv"+i]=0===t?e.$el.children("ul"):e["$lv"+(i-1)+"Li"].children("ul"),e["$lv"+i+"Li"]=e["$lv"+i].children("li"),e["$lv"+i+"Links"]=e["$lv"+i+"Li"].children("a")}),$.each(e.$lv1Links,function(t){e.$lv1Links.eq(t).data("idx",t)})},setClass:function(){var e=this,t=e.config;e.$el.addClass(t.prefix+"-"+t.navClass).addClass(t.direction),e.$lv1.addClass(t.levelClasses.lv1+" menubar"),e.$lv2.addClass(t.levelClasses.lv2+" menu"),e.$lv3.addClass(t.levelClasses.lv3+" menu"),$.each(e.$lv2,function(t){e.$lv2.eq(t).addClass("o"+(t+1))})},setARIA:function(){this.setARIARoles(),this.setARIAProperties(),this.setARIAStates()},setARIARoles:function(){this.$el.attr("role","navigation"),this.$el.find("li").attr("role","presentation"),this.$el.find("a").attr("role","menuitem"),this.$lv1.attr("role","menubar"),this.$lv1.find("ul").attr("role","menu")},setARIAProperties:function(){var e=this,t=e.$el.find("a");$.each(t,function(i){var s=t.eq(i);s.attr("id",e.config.prefix+"-popup-"+e.build+"-"+ ++e.menuitemIndex),s.next().length&&s.attr({"aria-haspopup":!0}).next().attr("aria-describedby",s.attr("id"))})},setARIAStates:function(){$("<span>",{id:"a11y-current-desc","class":"a11y-hidden"}).appendTo(this.$el),this.$lv1.attr("aria-activedescendant",""),this.config.useTabFocus||this.$lv1Links.filter(":not(:eq(0))").attr("tabindex",-1),this.$lv1Links.eq(0).attr("tabindex",0);var e=this.$lv1.find("ul");$.each(e,function(t){var i=e.eq(t);i.attr(i.is(":visible")?{"aria-expanded":!0,"aria-hidden":!1}:{"aria-expanded":!1,"aria-hidden":!0})})},events:function(){var e=this,t=e.config.hoverFocus?"mouseenter mouseleave focus blur":"click";e.$el.on(t,"a",$.proxy(e.expandToggleMenu,e)),t="click"===t?t+" focus blur":t,e.$el.on(t,"a",$.proxy(e.updateARIAStates,e)),e.$lv1Links.on("keydown keypress click",$.proxy(e.keyboardControls,e)),e.config.autoClose&&e.$el.on("mouseleave",$.proxy(e.removeAllActiveClass,e))},expandToggleMenu:function(e){var t=this.config,i=$(e.target);i.next().length&&e.preventDefault(),i.parent().radioClass(t.activeClass),i.next().find("."+t.activeClass).removeClass(t.activeClass),this.menuitemCurrent=i.data("idx")},updateARIAStates:function(e){switch(this.$lv1.attr("aria-activedescendant",$.activeElement().getAttribute("id")),e.type){case"focusin":this.$focusEl=$.$($.activeElement());case"click":case"mouseenter":this.$focusEl=$.$(e.target),this.$focusEl.attr("aria-describedby","a11y-current-desc"),$.$("#a11y-current-desc").text('현재 키보드가 활성화된 위치는 "'+this.$focusEl.text()+'" 메뉴 입니다.'),this.$lv2.add(this.$lv3).filter(":hidden").attr({"aria-hidden":!0,"aria-expanded":!1}),this.$focusEl.next(":visible").attr({"aria-hidden":!1,"aria-expanded":!0});break;case"focusout":case"mouseleave":this.$focusEl.attr("aria-describedby","")}this.config.autoClose&&this.autoClose(e)},keyboardControls:function(e){var t=this.$lv1Links.length,i=e.keyCode||e.which;switch(i){case 37:case 38:--this.menuitemCurrent<0&&(this.menuitemCurrent=t-1),this.$lv1Links.attr("tabindex",-1),this.$lv1Links.eq(this.menuitemCurrent).attr("tabindex",0).focus();break;case 39:case 40:++this.menuitemCurrent>=t&&(this.menuitemCurrent=0),this.$lv1Links.attr("tabindex",-1),this.$lv1Links.eq(this.menuitemCurrent).attr("tabindex",0).focus()}},autoClose:function(e){var t=this;"focusout"===e.type&&setTimeout(function(){""==t.$lv1.attr("aria-activedescendant")&&t.removeAllActiveClass()},1)},removeAllActiveClass:function(){var e=this.config.activeClass;this.$el.find("."+e).removeClass(e)}},$.fn[e]=$.fn[e]||function(e){var t=this;return $.each(t,function(s){var a=t.eq(s),n=new i(a,e);return a.data("navigationbar",n),a})},$.fn[e].defaults={prefix:"yamoo9",navClass:"navigation-bar",levelClasses:{lv1:"lv-1",lv2:"lv-2",lv3:"lv-3"},activeClass:"on",direction:"horizontal",hoverFocus:!0,aria:!0,useTabFocus:!0,autoClose:!0}});