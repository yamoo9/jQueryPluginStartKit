define(["plugins/radioClass/jquery.radioClass","utils/jquery.utils"],function(){"use strict";var t="navigationBar",e=0,i=function(e,i){this.$el=e,this.el=e[0],this.config=$.extend(!0,{},$.fn[t].defaults,i),this.menuitemIndex=0,this.menuitemCurrent=0,this.init()};i.prototype={init:function(){this.build=++e,this.settings(),this.events()},settings:function(){this.refLvEls(),this.setClass(),this.config.aria&&this.setARIA()},refLvEls:function(){var t=this;$.each([1,2,3],function(e,i){t["$lv"+i]=0===e?t.$el.children("ul"):t["$lv"+(i-1)+"Li"].children("ul"),t["$lv"+i+"Li"]=t["$lv"+i].children("li"),t["$lv"+i+"Links"]=t["$lv"+i+"Li"].children("a")}),$.each(t.$lv1Links,function(e){t.$lv1Links.eq(e).data("idx",e)}),$.each(t.$lv2,function(e){t.$lv2.eq(e).addClass("o"+(e+1))})},setClass:function(){var t=this.config;this.$el.addClass(t.prefix+"-"+t.navClass).addClass(t.direction),this.$lv1.addClass(t.levelClasses.lv1+" menubar"),this.$lv2.addClass(t.levelClasses.lv2+" menu"),this.$lv3.addClass(t.levelClasses.lv3+" menu")},setARIA:function(){this.setARIARoles(),this.setARIAProperties(),this.setARIAStates()},setARIARoles:function(){this.$el.attr("role","navigation"),this.$el.find("li").attr("role","presentation"),this.$el.find("a").attr("role","menuitem"),this.$lv1.attr("role","menubar"),this.$lv1.find("ul").attr("role","menu")},setARIAProperties:function(){var t=this,e=t.$el.find("a");$.each(e,function(i){var s=e.eq(i);s.attr("id",t.config.prefix+"-popup-"+t.build+"-"+ ++t.menuitemIndex),s.next().length&&s.attr({"aria-haspopup":!0}).next().attr("aria-describedby",s.attr("id"))})},setARIAStates:function(){$("<span>",{id:"a11y-current-desc","class":"a11y-hidden"}).appendTo(this.$el),this.$lv1.attr("aria-activedescendant",""),this.config.useTabFocus||this.$lv1Links.filter(":not(:eq(0))").attr("tabindex",-1),this.$lv1Links.eq(0).attr("tabindex",0);var t=this.$lv1.find("ul");$.each(t,function(e){var i=t.eq(e);i.attr(i.is(":visible")?{"aria-expanded":!0,"aria-hidden":!1}:{"aria-expanded":!1,"aria-hidden":!0})})},events:function(){var t=this.config.hoverFocus?"mouseenter mouseleave focus blur":"click";this.$el.on(t,"a",$.proxy(this.expandToggleMenu,this)),t="click"===t?t+" focus blur":t,this.$el.on(t,"a",$.proxy(this.updateARIAStates,this)),this.$lv1Links.on("keydown keypress click",$.proxy(this.keyboardControls,this)),this.config.autoClose&&this.$el.on("mouseleave",$.proxy(this.removeAllActiveClass,this))},expandToggleMenu:function(t){var e=this.config,i=$(t.target);i.next().length&&t.preventDefault(),i.parent().radioClass(e.activeClass),i.next().find("."+e.activeClass).removeClass(e.activeClass),this.menuitemCurrent=i.data("idx")},updateARIAStates:function(t){var e=this;switch(this.$lv1.attr("aria-activedescendant",$.activeElement().id),t.type){case"focusin":e.$focusEl=$.$($.activeElement());case"click":case"mouseenter":e.$focusEl=$.$(t.target),e.$focusEl.attr("aria-describedby","a11y-current-desc"),$.$("#a11y-current-desc").text('현재 키보드가 활성화된 위치는 "'+e.$focusEl.text()+'" 메뉴 입니다.'),e.$lv2.add(e.$lv3).filter(":hidden").attr({"aria-hidden":!0,"aria-expanded":!1}),e.$focusEl.next(":visible").attr({"aria-hidden":!1,"aria-expanded":!0});break;case"focusout":case"mouseleave":e.$focusEl.attr("aria-describedby","")}this.config.autoClose&&this.autoClose(t)},keyboardControls:function(t){var e=this.$lv1Links.length,i=t.keyCode||t.which;switch(i){case 37:case 38:--this.menuitemCurrent<0&&(this.menuitemCurrent=e-1),this.$lv1Links.attr("tabindex",-1),this.$lv1Links.eq(this.menuitemCurrent).attr("tabindex",0).focus();break;case 39:case 40:++this.menuitemCurrent>=e&&(this.menuitemCurrent=0),this.$lv1Links.attr("tabindex",-1),this.$lv1Links.eq(this.menuitemCurrent).attr("tabindex",0).focus()}},autoClose:function(t){var e=this;"focusout"===t.type&&setTimeout(function(){""==e.$lv1.attr("aria-activedescendant")&&e.removeAllActiveClass()},1)},removeAllActiveClass:function(){var t=this.config.activeClass;this.$el.find("."+t).removeClass(t)}},$.fn[t]=$.fn[t]||function(t){var e=this;return $.each(e,function(s){var a=e.eq(s);return new i(a,t),a})},$.fn[t].defaults={prefix:"yamoo9",navClass:"navigation-bar",levelClasses:{lv1:"lv-1",lv2:"lv-2",lv3:"lv-3"},activeClass:"on",direction:"horizontal",hoverFocus:!0,aria:!0,useTabFocus:!0,autoClose:!0}});